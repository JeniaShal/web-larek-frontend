# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в проекте

Карточка продукта
```
export interface ICard {
  category: string,
  id: string,
  name: string,
  description: string,
  picture: string,
  price: number
};
```

Заказ
```
export interface IOrder {
  paymentType: string,
  address: string,
  telephone: string,
  email: string,
  total: number,
  items: ICard[]
}
```

Интерфейс для модели данных карточек
```
export interface ICardsData {
  cards: ICard[],
  preview: string | null
}
```

Данные карточки, которые выводятся на главной странице
```
export type TCardInfo = Pick<ICard, 'category' | 'name' | 'picture' | 'price'>
```

Данные карточки, которые выводятся в отдельном поле
```
export type TCardDetails = Pick<ICard, 'category' | 'name' | 'description' | 'pic
```

Данные карточки, которые выводятся в корзине
```
export type TBasket = Pick<ICard, 'name' | 'price'>;
```

Данные заказа, которые выводятся в первом модальном окне оформления заказа
```
export type TOrderOrder = Pick<IOrder, 'paymentType' | 'address'>;
```

Данные заказа, которые выводятся во втором модальном окне оформления заказа
```
export type TOrderContacts = Pick<IOrder, 'email' | 'telephone'>;
```

Данные заказа, которые выводятся в модальном окне успешно завершенного заказа
```
export type TOrderSuccess = Pick<IOrder, 'total'>;
```
## Архитектура проекта

Код проекта написан в парадигме MVP и разделен на следующие слои: 
- слой View (представление): отображение данных на странице;
- слой Data (данные): хранение и изменение данных;
- Presenter (презентер): связь данных и представления

### Базовый код

#### Класс API

Описывает логику обмена данными с сервером. В конструктор передается базовый адрес сервера baseUrl, а также options: заголовок запроса формата 
```
  headers: {
    'Content-Type': 'application/json',
     ...(options.headers as object ?? {})
    }
```

Используемые метода класса:
- `get`: в качестве параметра принимает uri: string и выполняет GET-запрос на сервер на основании заданных параметров: "this.baseUrl + uri" и возвращает с сервера Промис с объектом 
- `post`: в качестве параметров принимает uri: string и data: object; через POST-запрос направляет на сервер с адресом "this.baseUrl + uri" объект "data", обработанный методом JSON.stringify

#### Класс EventEmitter

Класс создан с использованием типов
```
type EventName = string | RegExp;
type Subscriber = Function;
type EmitterEvent = {
    eventName: string,
    data: unknown
};
```

и интерфейса
```
export interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```
использумемые методы:
- `on`: устанавлливает обработчик на событие;
- `off`: снимает обработчик с события;
- `onAll`: устанавливает обработчики на все события;
- `offAll`: снимает обработчики со всех событий;
- `emit`: инициирует событие;
- `trigger`: устанавливает триггер, который инициирует событие

### Слой данных

#### Класс CardsData

отвечает за хранение и логику работы данных карточек с продуктами. 

Конструктор класса принимает инстант брокера событий.
В классе хранятся следующие данные:
-  _cards: ICard[] -  массив карточек продуктов; 
- _preview: string | null - id карточки выбранной для детального просмотра;
- events: IEvent - экземпляр класса `EventEmitter` для инициирования событий при изменении данных;

Также класс имеет определенные методы для взаимодействия с данными:
- addCard(card: ICard): void - добавление продукта в массив, если предусмотрен колбэк, то выполнение колбэка и обновление массива продуктов;
- deleteCard(cardId: string, payload: Function|null): void - удаление продукта из массива, если предусмотрен колбэк, то выполнение колбэка и обновление массива;
- getCard(cardId: string): ICard - возвращение карточки продукта по его id;
а также набор геттеров и сеттеров для сохранения и возвращения свойств класса;
- checkValidationCard

#### Класс OrderData
отвечает за хранение и логику работы данных пользователя при оформлении заказа.
Конструктор класса принимает инстант брокера событий.
В классе хранятся следующие данные:
- paymentType: string - выбранный тип оплаты заказа;
- address: string - адрес доставки заказа;
- telephone: string - номер телефона заказчика;
- email: string - адрес электронной почты заказчика;
- total: number - общая стоимость заказа;
- items: ICard[] - перечень заказанных продуктов;

а также методы: 
- addOrder (order: TOrder): void - добавление заказа на сервер;
- checkValidation (order: TOrder): boolean - валидация данных заказа при отправке на серверж
а также набор геттеров и сеттеров для сохранения и возвращения свойств класса.

### Слой представления

#### Класс Modal 
отвечает за работу универсального модального окна, наследниками которого будут модальные окна карточек продуктов и элементов оформления заказа на основании соответствующих шаблон.
Конструктор: constructor (template: HTMLElement, _events:IEvent) - принимает шаблон, на основании которого создается селектор, и событие брокера

Поля класса: 
- template: HTMLElement - шаблон, на основании которого будет создаваться конкретное модальное окно
- _event:IEvent - экземпляр класса `EventEmitter`, событие брокера событий.

Методы класса:
- open - открывает модальное окно;
- close - закрывает модальное окно;
- submitModal - передает данные из модального окна при наступлении действия;

#### Класс ModalSuccessfulOrder
расширяет класс `Modal`. Предназначен для реализации модального окна подтверждения успешного заказа. 

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения;
- handleSubmit: Function - функция, подтверждающая заказ;
- _form: HTMLFormElement - элемент формы;
- formName: string - значение атрибута name формы

Методы класса:
- open(submitModal: Function): void - расширенный метод родителя, принимает обработчик, который передается при иницииации метода.

#### Класс ModalWithForm
расширяет класс `Modal`. Предназначено для реализации модального окна с формой, содержащей поля ввода. При сабмите направляет данные, полученные из форм ввода, и инициирует событие. 

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения;
- handleSubmit: Function - функция, подтверждающая заказ;
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement>

Методы класса:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - имя инпута, значение - данноые введенные пользователем;
- setInputValues (data: Record<string, string>): void - принимает объект с данными для заполнения полей формы;
- setError(data: {field: string, value: string, validInformation: string}): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError(field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputValue (field: string): void - убирает текст ошибки под полем ввода
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithImage
Расширяет класс Modal. Предназначет для реализации модального окна с выведением изображения и дополнительных полей.
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения;
- handleSubmit: Function - функция, действующая при нажатии кнопки;
- 

Методы класса:
- open (data: {category: string, id: number, name: string, description: string, price: number}): void - расширяет родительский метод, принимает в качестве аргументов объект с данными о продукте.
- close (): void - - расширяет родительский метод, очищает аттрибуты.

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна с выведением списка продуктов.
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения;
- handleSubmit: Function - функция, подтверждающая заказ;
- numberOfCards: number - длина массива карт, переданных в корзину 

Методы класса:
- showItems(): 
- сеттер basket - для обновления отображения содержимого при добавлении карточек продукта
- showTotal(data.price[number]): number;

#### Класс CardPreview
Отвечает за отображение карточки с продуктом. Создается на основании DOM-элемента темплейта, передаваемого в конструктов. Задает в карточке продукта категорию продукта, его название, id, изображение, цену.
На интерактивные элементы карточки "навешиваются" слушатели событий.
Кроме DOM-элемента темплейта, в конструктор передается инстанс класса `EventEmitter`, для того, чтобы инициировать события.

Методы класса:
- setData (cardData: ICard): void - для присвоения атрибутам карточки значений с сервера;
- isInBasket(): boolean - возвращаает значение, добавлена ли карточка продукта в корзину;
- deleteCard(): void - удаляет карточку продукта из разметки;
- render(): HTMLElement - возвращает заполненную карточку;
- геттер id - возвращает уникальный id карточки;

#### Класс CardContainer
Отвечает за отображение карточек на главной странице. 

#### Класс BasketContainer
Отвечает за отображение карточек в корзине.
Метод класса:
- render(): HTMLElement - возвращает измененный контейнер при изменениях карточки;

### Слой коммуникации

#### Класс AppApi

## Взаимодействие компонентов 
Код, описывающий взаимодействие компонентов, находится в файле `index.ts`, который выполняет роль презентера.
Взаимодействие происходит за счет событий, генерируемых с помощью брокера событий и обработчиков событий, описанных в `index.ts`.

*Список событий, генерируемых в системе:*
*События, связанные с данными*
- `card:selected` - выбор карточки продукта для детального просмотра;
- `card: previewClear` - очистка данных при закрытии формы;
- `cards:changed` - изменение массива карточек продуктов;
- `order:changed` - изменение данных заказа


*События взаимодействия пользователя с интерфейсом*
- `card:select` - выбор карточки из массива главного окна для просмотра в модальном окне детального просмотра;
- `card:delete` - удаление карточки продукта из массива карточек, добавленных в корзину;
- `cardPreview:open` - открытие модального окна детального просмотра продукта;
- `cardPreview:addToBasket` - добавление продукта в корзину:
- `cardPreview:close` - закрытие модального окна детального просмотра продукта;
- `basket:open` - открытие модального окна с массивом карточек, добавленных в корзину;
- `basket:close` - закрытие модального окна с массивом карточек, добавленных в корзину;
- `basket:addToOrder` - передача массива объектов продуктов в информацию о заказе;
- `order:open` - открытие модальной карточки с оформлением заказа;
- `order:changed` - добавление данных в поля формы оформления заказа;
- `order:submit` - передача данных в следующую форму;
- `order:close` - закрытие модальной карточки;
- `order:validation` - валидация формы при вводе данных;
- `contacts:open` - открытие модальной карточки с оформлением заказа;
- `contacts:change` - добавление данных в поля формы оформления заказа;
- `contacts:submit` - передача данных о заказе;
- `contacts:validation` - валидация формы при вводе данных;
- `contacts:close` - закрытие модальной карточки;
- `success:open` - открытие модального окна с успешным заказом;
- `success:close`- закрытие модального окна с успешным заказом;
- `success:submit` - передача данных об успешном заказе;



